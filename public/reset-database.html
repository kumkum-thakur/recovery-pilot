<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Database Reset Tool</title>
  <style>
    body {
      font-family: system-ui, -apple-system, sans-serif;
      max-width: 800px;
      margin: 50px auto;
      padding: 20px;
      background: #f5f5f5;
    }
    .container {
      background: white;
      padding: 30px;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    h1 {
      color: #333;
      margin-top: 0;
    }
    button {
      background: #3b82f6;
      color: white;
      border: none;
      padding: 12px 24px;
      font-size: 16px;
      border-radius: 6px;
      cursor: pointer;
      margin: 10px 10px 10px 0;
    }
    button:hover {
      background: #2563eb;
    }
    button.danger {
      background: #ef4444;
    }
    button.danger:hover {
      background: #dc2626;
    }
    .output {
      background: #1e293b;
      color: #e2e8f0;
      padding: 20px;
      border-radius: 6px;
      margin-top: 20px;
      font-family: 'Courier New', monospace;
      font-size: 14px;
      white-space: pre-wrap;
      max-height: 400px;
      overflow-y: auto;
    }
    .credentials {
      background: #f0fdf4;
      border: 2px solid #86efac;
      padding: 20px;
      border-radius: 6px;
      margin-top: 20px;
    }
    .credentials h3 {
      margin-top: 0;
      color: #166534;
    }
    .cred-item {
      margin: 10px 0;
      padding: 10px;
      background: white;
      border-radius: 4px;
    }
    .cred-item strong {
      color: #166534;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üîß Database Reset Tool</h1>
    <p>Use this tool to reset the Recovery Pilot database with correct credentials.</p>
    
    <button onclick="runDiagnostics()">üîç Run Diagnostics</button>
    <button onclick="resetDatabase()">üîÑ Reset Database</button>
    <button onclick="clearAll()" class="danger">üóëÔ∏è Clear All Data</button>
    
    <div class="credentials">
      <h3>üìã Default Credentials</h3>
      <div class="cred-item">
        <strong>Admin:</strong> username = <code>admin</code>, password = <code>admin</code>
      </div>
      <div class="cred-item">
        <strong>Patient:</strong> username = <code>divya</code>, password = <code>divya</code>
      </div>
      <div class="cred-item">
        <strong>Doctor:</strong> username = <code>dr.smith</code>, password = <code>smith</code>
      </div>
    </div>
    
    <div class="output" id="output">Click a button above to start...</div>
  </div>

  <script>
    const output = document.getElementById('output');
    
    function log(message) {
      output.textContent += message + '\n';
      output.scrollTop = output.scrollHeight;
    }
    
    function clearOutput() {
      output.textContent = '';
    }
    
    function runDiagnostics() {
      clearOutput();
      log('üîç RUNNING DIAGNOSTICS...\n');
      
      // Check localStorage
      const usersJson = localStorage.getItem('recovery_pilot_users');
      if (!usersJson) {
        log('‚ùå No users found in localStorage');
        log('üí° Click "Reset Database" to fix\n');
        return;
      }
      log('‚úÖ Users data exists\n');
      
      // Parse users
      let users;
      try {
        users = JSON.parse(usersJson);
        log(`‚úÖ Found ${users.length} users\n`);
      } catch (e) {
        log('‚ùå Failed to parse users: ' + e.message);
        return;
      }
      
      // Check admin
      const admin = users.find(u => u.username === 'admin');
      if (!admin) {
        log('‚ùå Admin user not found');
        log('üí° Click "Reset Database" to fix\n');
        return;
      }
      
      log('‚úÖ Admin user found');
      log('   Username: ' + admin.username);
      log('   Password Hash: ' + admin.passwordHash);
      log('   Expected Hash: simple_hash_admin\n');
      
      // Verify hash
      if (admin.passwordHash === 'simple_hash_admin') {
        log('‚úÖ Password hash is CORRECT!');
        log('‚úÖ Login should work with admin/admin\n');
      } else {
        log('‚ùå Password hash is WRONG!');
        log('üí° Click "Reset Database" to fix\n');
      }
      
      // List all users
      log('üë• ALL USERS:');
      users.forEach(u => {
        log(`   ${u.role}: ${u.username} (${u.passwordHash})`);
      });
    }
    
    function resetDatabase() {
      clearOutput();
      log('üîÑ RESETTING DATABASE...\n');
      
      // Clear everything
      localStorage.clear();
      sessionStorage.clear();
      log('‚úÖ Cleared all storage\n');
      
      // Create users
      const users = [
        {
          id: 'admin-1',
          username: 'admin',
          passwordHash: 'simple_hash_admin',
          name: 'System Administrator',
          role: 'admin',
          streakCount: 0,
          lastLoginDate: new Date().toISOString(),
          createdAt: new Date().toISOString()
        },
        {
          id: 'patient-1',
          username: 'divya',
          passwordHash: 'simple_hash_divya',
          name: 'Divya Patel',
          role: 'patient',
          streakCount: 0,
          lastLoginDate: new Date().toISOString(),
          createdAt: new Date().toISOString()
        },
        {
          id: 'doctor-1',
          username: 'dr.smith',
          passwordHash: 'simple_hash_smith',
          name: 'Dr. Sarah Smith',
          role: 'doctor',
          streakCount: 0,
          lastLoginDate: new Date().toISOString(),
          createdAt: new Date().toISOString()
        }
      ];
      
      // Create missions
      const missions = [
        {
          id: 'mission-1',
          patientId: 'patient-1',
          type: 'photo_upload',
          title: 'Mission 1: Scan Incision',
          description: 'Take a photo of your surgical incision',
          status: 'pending',
          dueDate: new Date().toISOString()
        },
        {
          id: 'mission-2',
          patientId: 'patient-1',
          type: 'medication_check',
          title: 'Mission 2: Medication Check',
          description: 'Confirm you took your antibiotics',
          status: 'pending',
          dueDate: new Date().toISOString()
        }
      ];
      
      // Create relationships
      const relationships = [
        {
          id: 'rel-1',
          patientId: 'patient-1',
          doctorId: 'doctor-1',
          assignedAt: new Date().toISOString(),
          assignedBy: 'admin-1',
          active: true
        }
      ];
      
      // Save to localStorage
      localStorage.setItem('recovery_pilot_users', JSON.stringify(users));
      localStorage.setItem('recovery_pilot_missions', JSON.stringify(missions));
      localStorage.setItem('recovery_pilot_relationships', JSON.stringify(relationships));
      localStorage.setItem('recovery_pilot_action_items', JSON.stringify([]));
      
      log('‚úÖ Created 3 users');
      log('‚úÖ Created 2 missions');
      log('‚úÖ Created 1 relationship');
      log('‚úÖ Saved to localStorage\n');
      
      log('‚úÖ DATABASE RESET COMPLETE!\n');
      log('üìã You can now login with:');
      log('   Admin: admin / admin');
      log('   Patient: divya / divya');
      log('   Doctor: dr.smith / smith\n');
      log('üîÑ Go back to the app and try logging in!');
    }
    
    function clearAll() {
      if (confirm('This will delete ALL data. Continue?')) {
        clearOutput();
        localStorage.clear();
        sessionStorage.clear();
        log('‚úÖ All data cleared!');
        log('üîÑ Refresh the main app to reinitialize');
      }
    }
  </script>
</body>
</html>
