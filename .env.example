# =============================================================================
# RecoveryPilot - Environment Configuration
# =============================================================================
# Single source of truth for ALL configurable variables.
# Secrets (DB password, JWT, encryption keys) are auto-generated by autoconfig.sh.
#
# Usage:
#   cp .env.example .env
#   nano .env                           # Set DOMAIN and tune values
#   sudo bash autoconfig.sh --deploy    # Deploys everything
#
# IMPORTANT: Never commit .env to version control.
# =============================================================================

# ── Domain ──────────────────────────────────────────────────────────────────
# Set your domain/subdomain here. autoconfig.sh reads this automatically.
# Examples: app.yourdomain.com, recoverypilot.example.com
# Leave empty to serve on the VM's public IP (HTTP only, no SSL).
DOMAIN=

# ── Google Gemini API Key ───────────────────────────────────────────────────
# Get your key at: https://aistudio.google.com/apikey
# If not set, wound analysis will use fallback simulation mode.
GEMINI_KEY=
VITE_GEMINI_KEY=

# ── API Server ──────────────────────────────────────────────────────────────
API_PORT=3000
# 0 = auto (one worker per CPU core)
CLUSTER_WORKERS=0
# Frontend API base URL override (default: /api/v1 via Nginx reverse proxy)
# VITE_API_BASE_URL=

# ── Database (PostgreSQL) ───────────────────────────────────────────────────
# DB_PASSWORD is auto-generated and safely rotated. Do NOT set it here.
DB_HOST=127.0.0.1
DB_PORT=5432
DB_NAME=recovery_pilot
DB_USER=rp_app
DB_SSL=false
DB_POOL_MIN=5
DB_POOL_MAX=20
DB_IDLE_TIMEOUT_MS=30000
DB_ACQUIRE_TIMEOUT_MS=60000
DB_STATEMENT_TIMEOUT_MS=30000
# Comma-separated replica hosts (optional, for read scaling)
DB_REPLICA_HOSTS=
DB_REPLICA_POOL_MAX=20

# ── Redis ───────────────────────────────────────────────────────────────────
# REDIS_PASSWORD is auto-generated and safely rotated. Do NOT set it here.
REDIS_HOST=127.0.0.1
REDIS_PORT=6379
REDIS_TLS=false
REDIS_MAX_MEMORY=512mb
REDIS_KEY_PREFIX=rp:
REDIS_MAX_RETRIES=3
# Cluster mode (optional, for K8s deployments)
REDIS_CLUSTER_ENABLED=false
REDIS_CLUSTER_NODES=

# ── Region & Compliance ─────────────────────────────────────────────────────
# ap-south-1 (India/DPDPA) | us-east-1 (US/HIPAA) | eu-west-2 (UK/UK_GDPR)
DEPLOYMENT_REGION=ap-south-1
COMPLIANCE_REGIME=DPDPA
DATA_RESIDENCY_REGION=ap-south-1

# ── Authentication ──────────────────────────────────────────────────────────
# JWT_SECRET, SESSION_SECRET are auto-generated. Do NOT set them here.
JWT_EXPIRY=15m
JWT_REFRESH_EXPIRY=7d
JWT_ISSUER=recovery-pilot
MFA_ENABLED=false
# Argon2id password hashing (modern replacement for bcrypt)
ARGON2_MEMORY_COST=65536
ARGON2_TIME_COST=3
ARGON2_PARALLELISM=4

# ── Encryption ──────────────────────────────────────────────────────────────
# ENCRYPTION_MASTER_KEY is auto-generated once and NEVER rotated (data would be lost).
ENCRYPTION_ALGORITHM=aes-256-gcm
FIELD_LEVEL_ENCRYPTION=true
# AWS KMS key ARN (optional — for cloud-managed key wrapping)
AWS_KMS_KEY_ARN=

# ── Rate Limiting ───────────────────────────────────────────────────────────
RATE_LIMIT_WINDOW_MS=60000
RATE_LIMIT_MAX_REQUESTS=100
RATE_LIMIT_AUTH_MAX=10
RATE_LIMIT_API_MAX=1000
RATE_LIMIT_STORE=redis

# ── Logging & Monitoring ───────────────────────────────────────────────────
LOG_LEVEL=info
LOG_FORMAT=json
METRICS_ENABLED=false
METRICS_PORT=9090
TRACING_ENABLED=false
OTEL_EXPORTER_OTLP_ENDPOINT=
SENTRY_DSN=

# ── Audit ───────────────────────────────────────────────────────────────────
AUDIT_LOG_RETENTION_DAYS=2555
AUDIT_LOG_IMMUTABLE=true
AUDIT_LOG_DESTINATION=database

# ── Email (optional) ────────────────────────────────────────────────────────
SMTP_HOST=
SMTP_PORT=587
SMTP_USER=
SMTP_PASSWORD=

# ── SMS (optional) ──────────────────────────────────────────────────────────
# twilio | sns | msg91
SMS_PROVIDER=msg91
SMS_API_KEY=

# ── AWS (optional — for S3, KMS, backups) ───────────────────────────────────
AWS_REGION=
AWS_ACCESS_KEY_ID=
AWS_SECRET_ACCESS_KEY=
S3_BUCKET_MEDICAL_IMAGES=
S3_BUCKET_AUDIT_LOGS=
S3_BUCKET_BACKUPS=
S3_ENCRYPTION=aws:kms

# ── Job Queue ───────────────────────────────────────────────────────────────
# Uses Redis by default. Set separate host only if using a dedicated queue Redis.
QUEUE_REDIS_HOST=
QUEUE_REDIS_PORT=
QUEUE_CONCURRENCY=50

# ── Kubernetes Deployment (only for autodeploy-k8s.sh) ──────────────────────
# Container registry URL (e.g., gcr.io/your-project)
REGISTRY=
IMAGE_TAG=latest
K8S_CONTEXT=
